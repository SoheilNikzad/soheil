<script>
window.addEventListener("DOMContentLoaded", () => {
  const recipientInput = document.getElementById('recipient');

  if (!recipientInput) return console.error("Required elements not found - recipient input is missing");
  if (!document.getElementById('contactsLink') || !document.getElementById('inboxLink') || !document.getElementById('cardContent')) {
    console.error("Sidebar links or cardContent missing in DOM");
    return;
  }

  // ✅ CONTACTS: Load and make selectable
  document.getElementById('contactsLink').addEventListener('click', () => {
    const contacts = JSON.parse(localStorage.getItem('contacts') || '[]');
    let html = `<h3>Contacts</h3><ul style='list-style: none; padding-left: 0;'>`;
    html += contacts.map(c => `<li style='margin-bottom: 0.5em;'>
      <button onclick='selectContact("${c.address}")' style='width:100%;padding:0.6em;border:1px solid #ccc;border-radius:6px;'>
        <strong>${c.name}</strong><br><span style='font-size:0.85em;'>${c.address}</span>
      </button>
    </li>`).join('');
    html += `</ul><hr/><input id='contactName' placeholder='Name'><input id='contactAddress' placeholder='Wallet Address'>
      <button onclick='addContact()'>+ Add Contact</button>`;
    document.getElementById('cardContent').innerHTML = html;
  });

  window.selectContact = (address) => {
    const recField = document.getElementById('recipient');
    if (recField) recField.value = address;
  }

  window.addContact = () => {
    const name = document.getElementById('contactName')?.value.trim();
    const address = document.getElementById('contactAddress')?.value.trim();
    if (!name || !address) return alert("Enter both fields");
    const contacts = JSON.parse(localStorage.getItem('contacts') || '[]');
    contacts.push({ name, address });
    localStorage.setItem('contacts', JSON.stringify(contacts));
    document.getElementById('contactsLink').click();
  }

  // ✅ INBOX: Display detailed messages
  document.getElementById('inboxLink').addEventListener('click', () => {
    const messages = JSON.parse(localStorage.getItem('messages') || '[]');
    let html = `<h3>Inbox</h3>`;
    if (messages.length === 0) html += `<p>No messages found.</p>`;
    else html += messages.map(m => `
      <div style='margin-bottom:1em;padding:1em;border:1px solid #ddd;border-radius:6px;'>
        <strong>From:</strong> ${m.from}<br>
        <strong>Message:</strong> ${m.text}<br>
        <small style='color:gray;'>${m.date || new Date().toLocaleString()}</small>
      </div>`).join('');
    document.getElementById('cardContent').innerHTML = html;
  });
});
</script>
