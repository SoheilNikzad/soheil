<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Web3 Messenger</title>
  <link rel="stylesheet" href="style.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300..700&family=Inter:wght@100..900&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Contacts</h2>
        <button id="connectWalletBtn" class="glow-button">Connect Wallet</button>
        <button id="registerKeyBtn" class="glow-button-small">Register Public Key</button>

        <div id="publicKeyBox" class="user-info" style="display: none;">
          <p><strong>Your Public Key:</strong></p>
          <textarea id="publicKeyDisplay" readonly></textarea>
        </div>
      </div>

      <div id="userInfo" class="user-info" style="display: none;">
        <p><strong>Address:</strong> <span id="userAddress"></span></p>
        <p><strong>Network:</strong> <span id="networkName"></span> (<span id="chainId"></span>)</p>
      </div>

      <div id="contactList" class="contact-list">
        <!-- Contacts will be listed here -->
      </div>
    </aside>

    <main class="chat-area">
      <header class="chat-header">
        <h3 id="chattingWith">Select a chat</h3>
        <button id="clearCacheBtn" class="glow-button-small" style="display: none;">Clear Cache</button>
      </header>

      <div id="messageList" class="message-list">
        <!-- Messages will appear here -->
      </div>

      <footer class="chat-footer">
        <input type="text" id="recipientAddressInput" placeholder="Recipient Address"/>
        <input type="text" id="recipientPublicKeyInput" placeholder="Recipient Public Key"/>
        <input type="text" id="senderPrivateKeyInput" placeholder="Your Private Key (hex)"/>
        <textarea id="messageInput" placeholder="Type your message..."></textarea>
        <button id="sendMessageBtn" class="glow-button">Send</button>
        <button id="encryptOnlyBtn" class="glow-button-small">Encrypt Message</button>
        <pre id="encryptedOutputBox" style="white-space: pre-wrap; color: lime; margin-top: 10px;"></pre>
      </footer>

      <!-- ðŸ“¥ Section: Decryption Zone -->
      <section id="decryptionZone" style="padding: 20px; border-top: 1px solid #3a3a3a;">
        <h3 style="color: #ffa500; font-family: 'Comfortaa'; margin-bottom: 15px;">Encrypted Messages</h3>

        <div class="encrypted-message-box">
          <label for="ciphertextInput">Ciphertext (base64)</label>
          <textarea id="ciphertextInput" placeholder="Paste the encrypted message here..."></textarea>

          <label for="nonceInput">Nonce (base64)</label>
          <input type="text" id="nonceInput" placeholder="Paste the nonce here..."/>

          <label for="senderPublicKeyInput">Sender's Public Key (base64)</label>
          <input type="text" id="senderPublicKeyInput" placeholder="Paste sender's public key..."/>

          <label for="yourPrivateKeyInput">Your Private Key (hex)</label>
          <input type="text" id="yourPrivateKeyInput" placeholder="Paste your private key..."/>

          <button id="decryptMessageBtn" class="glow-button-small" style="margin-top: 10px;">Decrypt</button>
          <pre id="decryptedOutputBox" style="white-space: pre-wrap; color: lightgreen; margin-top: 10px;"></pre>
        </div>
      </section>
    </main>
  </div>

  <div id="qrCodeModal" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <p>Scan QR Code to connect mobile wallet (placeholder)</p>
      <div id="qrCodeContainer"></div>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://unpkg.com/localforage@1.10.0/dist/localforage.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tweetnacl@1.0.3/nacl.min.js"></script>

  <!-- App Logic -->
  <script src="app.js"></script>
</body>
</html>
